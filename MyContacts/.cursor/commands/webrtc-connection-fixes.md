# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º –∏ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. üîß **–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**
**–ü—Ä–æ–±–ª–µ–º–∞:** WebSocket –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–ª—Å—è –≤–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–æ–≤
**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏–ª–∏ —Ç–∞–π–º–∞—É—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (30 —Å–µ–∫—É–Ω–¥)
- –£–ª—É—á—à–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (2-10 —Å–µ–∫—É–Ω–¥ –∑–∞–¥–µ—Ä–∂–∫–∞)
- –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (websocket, polling)
- –û—Ç–∫–ª—é—á–∏–ª–∏ `forceNew` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### 2. üßä **–ü—Ä–æ–±–ª–µ–º—ã —Å ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏**
**–ü—Ä–æ–±–ª–µ–º–∞:** ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∞—É–¥–∏–æ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–æ—Å—å
**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ–∂–∏–¥–∞—é—â–∏—Ö ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PeerConnection
- –£–ª—É—á—à–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- –î–æ–±–∞–≤–∏–ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PeerConnection

### 3. üåê **–£–ª—É—á—à–µ–Ω–Ω—ã–µ ICE —Å–µ—Ä–≤–µ—Ä—ã**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TURN —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è NAT traversal
**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏–ª–∏ –±–æ–ª—å—à–µ STUN —Å–µ—Ä–≤–µ—Ä–æ–≤ (Google, VoIP —Å–µ—Ä–≤–µ—Ä—ã)
- –£–≤–µ–ª–∏—á–∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ TURN —Å–µ—Ä–≤–µ—Ä–æ–≤ (Metered.ca, Bistri, AnyFirewall)
- –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É TCP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –¥–ª—è TURN —Å–µ—Ä–≤–µ—Ä–æ–≤

### 4. ‚öôÔ∏è **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PeerConnection**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏–ª–∏ –ø—É–ª ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–æ 10
- –î–æ–±–∞–≤–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –í–∫–ª—é—á–∏–ª–∏ QoS (DSCP) –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
- –ù–∞—Å—Ç—Ä–æ–∏–ª–∏ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (30 —Å–µ–∫—É–Ω–¥)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### WebSocket –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```kotlin
val opts = IO.Options().apply {
    forceNew = false // –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    reconnectionDelay = 2000 // 2 —Å–µ–∫—É–Ω–¥—ã –∑–∞–¥–µ—Ä–∂–∫–∞
    reconnectionDelayMax = 10000 // 10 —Å–µ–∫—É–Ω–¥ –º–∞–∫—Å–∏–º—É–º
    timeout = 30000 // 30 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
    transports = arrayOf("websocket", "polling") // –û–±–∞ —Ç–∏–ø–∞
}
```

### ICE —Å–µ—Ä–≤–µ—Ä—ã
```kotlin
private val iceServers = listOf(
    // Google STUN —Å–µ—Ä–≤–µ—Ä—ã
    PeerConnection.IceServer.builder("stun:stun.l.google.com:19302"),
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ STUN —Å–µ—Ä–≤–µ—Ä—ã
    PeerConnection.IceServer.builder("stun:stun.voipbuster.com:3478"),
    // TURN —Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è NAT traversal
    PeerConnection.IceServer.builder("turn:global.relay.metered.ca:80")
        .setUsername("...").setPassword("..."),
    // TCP TURN —Å–µ—Ä–≤–µ—Ä—ã
    PeerConnection.IceServer.builder("turn:global.relay.metered.ca:443?transport=tcp")
)
```

### PeerConnection –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```kotlin
val rtcConfig = PeerConnection.RTCConfiguration(iceServers).apply {
    iceCandidatePoolSize = 10 // –ë–æ–ª—å—à–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
    iceConnectionReceivingTimeout = 30000 // 30 —Å–µ–∫—É–Ω–¥
    iceBackupCandidatePairPingInterval = 25000 // 25 —Å–µ–∫—É–Ω–¥
    enableDscp = true // Quality of Service
    enableRtpDataChannel = false // –¢–æ–ª—å–∫–æ –∞—É–¥–∏–æ
}
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** - –º–µ–Ω—å—à–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–æ–≤
2. **–£—Å–ø–µ—à–Ω–æ–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ** - ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–õ—É—á—à–∏–π NAT traversal** - –±–æ–ª—å—à–µ TURN —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–µ—Ç–µ–π
4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏:
- `‚úÖ AUDIO CONNECTION ESTABLISHED` - —É—Å–ø–µ—à–Ω–æ–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ
- `üßä Processing X pending ICE candidates` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- `‚úÖ Added remote ICE candidate` - —É—Å–ø–µ—à–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- `üîå WebSocket connecting` - —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
