# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –∞—É–¥–∏–æ –≤ WebRTC

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. üîß **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ICE gathering –ø—Ä–æ—Ü–µ—Å—Å–∞
- –î–æ–±–∞–≤–∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ —Ç—Ä–µ–∫–∞

### 2. üé§ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ —Ç—Ä–µ–∫–∞**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ê—É–¥–∏–æ —Ç—Ä–µ–∫ –º–æ–≥ –±—ã—Ç—å null –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ PeerConnection
**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ null –¥–ª—è localAudioTrack
- –î–æ–±–∞–≤–∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
- –£–ª—É—á—à–∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–µ–∫–∞

### 3. üßä **–£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞–ª–∏—Å—å –ø–æ–¥—Ä–æ–±–Ω–æ
**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É targetUserId –∏ callId –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –£–ª—É—á—à–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

## –ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
```
üÜï ICE connection: NEW - Starting connection process
üîç ICE connection: CHECKING - Testing connectivity
‚úÖ AUDIO CONNECTION ESTABLISHED - Can talk now!
üéâ ICE connection: COMPLETED - All candidates tested
```

### ICE gathering
```
üÜï ICE gathering: NEW - Starting to gather candidates
üîç ICE gathering: GATHERING - Collecting candidates
‚úÖ ICE gathering: COMPLETE - All candidates collected
```

### ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
```
üßä New ICE candidate: 0 - candidate:1 1 UDP 2113667326 192.168.1.100 54400...
üì§ Sending ICE candidate to targetUserId
```

### –ê—É–¥–∏–æ —Ç—Ä–µ–∫
```
‚úÖ Audio track added to peer connection
‚ùå Local audio track is null! Creating new one...
‚úÖ Audio track created and added to peer connection
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º

### 1. **ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è**
**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü—Ä–æ–±–ª–µ–º—ã —Å NAT/firewall
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å TURN —Å–µ—Ä–≤–µ—Ä–æ–≤
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ICE —Å–µ—Ä–≤–µ—Ä—ã
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
üîç ICE connection: CHECKING - Testing connectivity
‚ùå ICE connection: FAILED - No connectivity
```

### 2. **–ê—É–¥–∏–æ —Ç—Ä–µ–∫ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è**
**–ü—Ä–∏—á–∏–Ω—ã:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω
- –ü—Ä–æ–±–ª–µ–º—ã —Å AudioManager
- –û—à–∏–±–∫–∏ –≤ createLocalMediaStream

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
‚ùå Local audio track is null! Creating new one...
‚ùå Failed to create local audio track
```

### 3. **ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è**
**–ü—Ä–∏—á–∏–Ω—ã:**
- WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç targetUserId –∏–ª–∏ callId
- –ü—Ä–æ–±–ª–µ–º—ã —Å emitSafe

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
‚ö†Ô∏è No target user or call ID for ICE candidate
üì§ Sending ICE candidate to targetUserId
```

## –†–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

### 1. **–ï—Å–ª–∏ ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å TURN —Å–µ—Ä–≤–µ—Ä–æ–≤
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ –∏–ª–∏ –µ—Å—Ç—å TURN —Å–µ—Ä–≤–µ—Ä—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ firewall

### 2. **–ï—Å–ª–∏ –∞—É–¥–∏–æ —Ç—Ä–µ–∫ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ AudioManager –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ createLocalMediaStream

### 3. **–ï—Å–ª–∏ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ targetUserId –∏ callId —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ emitSafe —Ñ—É–Ω–∫—Ü–∏—é

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –ª–æ–≥–æ–≤:
1. `üéØ Creating WebRTC offer...` - —Å–æ–∑–¥–∞–Ω–∏–µ offer
2. `‚úÖ Offer created successfully` - offer —Å–æ–∑–¥–∞–Ω
3. `üßä ICE gathering: GATHERING` - —Å–±–æ—Ä ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
4. `üßä New ICE candidate` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
5. `üîç ICE connection: CHECKING` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
6. `‚úÖ AUDIO CONNECTION ESTABLISHED` - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
